---
title: "HW 02"
author: "Nilotpal Rajbongshi"
format: 
  html:
    embed-resources: true
toc: true
execute:
  warning: false
  error: false
  message: false
---

## 0 - Setup

```{r setup}
if (!require("pacman")) 
  install.packages("pacman")

# use this line for installing/loading
pacman::p_load(dsbox, 
               dplyr, 
               ggplot2,
               ggridges,
               forcats,
               tidyverse,
               janitor,
               fs,
               scales) 

devtools::install_github("tidyverse/dsbox")
```

## 1 - A new day, a new plot, a new geom
## Question 1: Ridgeline Plot of Airbnb Review Scores
```{r}
#| label: Question 1
# Load and prepare data
data("edibnb", package = "dsbox")

# Clean and transform
edibnb_clean <- edibnb %>%
  filter(
    !is.na(review_scores_rating),
    !is.na(neighbourhood)
  ) %>%
  mutate(
    neighbourhood = fct_reorder(neighbourhood, review_scores_rating, median)
  )

# Plot: Ridgeline of Airbnb review scores by neighborhood
ggplot(edibnb_clean, aes(x = review_scores_rating, y = neighbourhood)) +
  geom_density_ridges(
    scale = 2,
    rel_min_height = 0.01,
    aes(fill = neighbourhood),
    color = "gray40",
    show.legend = TRUE
  ) +
  labs(
    title = "Plot of Airbnb Review Scores by Neighborhood in Edinburgh",
    subtitle = "Neighborhoods are ordered by their median review scores",
    x = "Review Score Rating",
    y = "Neighborhood",
    fill = "Neighborhood",
    caption = "Source: dsbox package, edibnb dataset"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 12, color = "gray40"),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12)
  )
```
The ridgeline plot displays the distribution of Airbnb review scores across Edinburgh neighborhoods. Neighborhoods are ordered by their median review scores, allowing us to easily compare their central tendencies and spread. Higher ridges indicate more frequent score values. We observe that some areas consistently have higher review scores, while others show greater variability. Listings with missing neighborhood or review data were excluded here.

## 2 - Foreign Connected PACs

```{r}
#| label: Question 2
# Step 1: List files with "Foreign Connected PAC" in their name
list_of_files <- dir_ls(path = "data", regexp = "Foreign Connected PAC")

# Step 2: Read and combine files, keeping filename in a new column `year`
pac <- read_csv(list_of_files, id = "year")

# Step 3: Extract year from file path
pac <- pac %>%
  mutate(year = str_extract(year, "\\d{4}"))

# Step 4: Clean currency columns
pac_clean <- pac %>%
  mutate(across(c(Total, Dems, Repubs), ~ as.numeric(gsub("[$,]", "", .))))

# Step 5: Split country and parent company
pac_clean <- pac_clean %>%
  separate(`Country of Origin/Parent Company`,
           into = c("Country", "Parent_Company"),
           sep = "/", extra = "merge", fill = "right")

# Step 6: Summarize by Country
country_summary <- pac_clean %>%
  group_by(year, Country) %>%
  summarise(
    Total = sum(Total, na.rm = TRUE),
    Dems = sum(Dems, na.rm = TRUE),
    Repubs = sum(Repubs, na.rm = TRUE)
  ) %>%
  arrange(desc(Total))

# Step 7: Get top 10 countries by Total
top_countries <- country_summary %>%
  slice_max(Total, n = 10) %>%
  pull(Country)

# Step 8: Filter and reshape for plotting
country_long <- country_summary %>%
  filter(Country == "UK", year %in% unique(pac_clean$year)) %>%
  pivot_longer(cols = c(Dems, Repubs), names_to = "Party", values_to = "Amount")

# Step 9: Plot
ggplot(country_long, aes(x = year, y = Amount, color = Party, group = Party)) +
  geom_smooth(method = "gam", formula = y ~ s(x, bs = "cs"), linewidth = 1.2, se = FALSE) +
  scale_color_manual(values = c("Dems" = "#2E86C1", "Repubs" = "#C0392B")) +
  scale_y_continuous(labels = scales::dollar) +
  labs(
    title = "Foreign PAC Contributions Over Time (Smoothed)",
    x = "Year",
    y = "Total Contributions (USD)",
    color = "Party"
  ) +
  theme_minimal(base_size = 14)

```

## 3 - Median housing prices in the US


## 4 - Expect More. Plot More.


## 5 - Mirror, mirror on the wall, whoâ€™s the ugliest of them all?
